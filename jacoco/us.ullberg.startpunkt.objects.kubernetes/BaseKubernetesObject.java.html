<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BaseKubernetesObject.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">startpunkt</a> &gt; <a href="index.source.html" class="el_package">us.ullberg.startpunkt.objects.kubernetes</a> &gt; <span class="el_source">BaseKubernetesObject.java</span></div><h1>BaseKubernetesObject.java</h1><pre class="source lang-java linenums">package us.ullberg.startpunkt.objects.kubernetes;

import io.fabric8.kubernetes.api.model.GenericKubernetesResource;
import io.fabric8.kubernetes.api.model.GenericKubernetesResourceList;
import io.fabric8.kubernetes.client.KubernetesClient;
import io.fabric8.kubernetes.client.dsl.base.ResourceDefinitionContext;
import io.quarkus.logging.Log;
import jakarta.annotation.Nullable;
import java.util.List;
import java.util.Map;
import us.ullberg.startpunkt.crd.v1alpha4.ApplicationSpec;

/**
 * Abstract base class representing a Kubernetes custom resource wrapper. Provides common
 * functionality to retrieve application specifications and metadata from Kubernetes generic
 * resources.
 */
public abstract class BaseKubernetesObject implements KubernetesObject {
  private String group;
  private String version;
  private String pluralKind;

  /**
   * Constructs the wrapper with the specified API group, version, and plural kind.
   *
   * @param group the API group of the Kubernetes resource
   * @param version the API version of the Kubernetes resource
   * @param pluralKind the plural kind name of the Kubernetes resource
   */
<span class="fc" id="L30">  protected BaseKubernetesObject(String group, String version, String pluralKind) {</span>
<span class="fc" id="L31">    this.group = group;</span>
<span class="fc" id="L32">    this.version = version;</span>
<span class="fc" id="L33">    this.pluralKind = pluralKind;</span>
<span class="fc" id="L34">  }</span>

  /**
   * Returns the API group of the Kubernetes resource.
   *
   * @return the API group string
   */
  public String getGroup() {
<span class="fc" id="L42">    return group;</span>
  }

  /**
   * Returns the API version of the Kubernetes resource.
   *
   * @return the API version string
   */
  public String getVersion() {
<span class="fc" id="L51">    return version;</span>
  }

  /**
   * Returns the plural kind name of the Kubernetes resource.
   *
   * @return the plural kind string
   */
  public String getPluralKind() {
<span class="fc" id="L60">    return pluralKind;</span>
  }

  /**
   * Builds a ResourceDefinitionContext for the Kubernetes custom resource.
   *
   * @return the resource definition context
   */
  private ResourceDefinitionContext getResourceDefinitionContext() {
<span class="fc" id="L69">    return new ResourceDefinitionContext.Builder()</span>
<span class="fc" id="L70">        .withGroup(group)</span>
<span class="fc" id="L71">        .withVersion(version)</span>
<span class="fc" id="L72">        .withPlural(pluralKind)</span>
<span class="fc" id="L73">        .withNamespaced(true)</span>
<span class="fc" id="L74">        .build();</span>
  }

  /**
   * Retrieves a list of generic Kubernetes resources of this type, filtered by namespaces.
   *
   * @param client the Kubernetes client instance
   * @param anyNamespace if true, searches across all namespaces; otherwise uses matchNames
   * @param matchNames list of namespace names to filter on (used only if anyNamespace is false)
   * @return list of GenericKubernetesResource objects
   */
  protected GenericKubernetesResourceList getGenericKubernetesResources(
      KubernetesClient client, boolean anyNamespace, List&lt;String&gt; matchNames) {
<span class="fc" id="L87">    ResourceDefinitionContext resourceDefinitionContext = getResourceDefinitionContext();</span>
<span class="fc" id="L88">    Log.debugf(&quot;Fetching %s/%s resources from Kubernetes&quot;, group, pluralKind);</span>

    try {
<span class="fc bfc" id="L91" title="All 2 branches covered.">      if (anyNamespace) {</span>
<span class="fc" id="L92">        Log.debug(&quot;Searching across all namespaces&quot;);</span>
<span class="fc" id="L93">        GenericKubernetesResourceList result =</span>
<span class="fc" id="L94">            client.genericKubernetesResources(resourceDefinitionContext).inAnyNamespace().list();</span>
<span class="fc" id="L95">        Log.debugf(&quot;Found %d %s resources in all namespaces&quot;, result.getItems().size(), pluralKind);</span>
<span class="fc" id="L96">        return result;</span>
      }

<span class="fc" id="L99">      GenericKubernetesResourceList list = new GenericKubernetesResourceList();</span>
<span class="fc" id="L100">      Log.debugf(&quot;Searching in specific namespaces: %s&quot;, matchNames);</span>
<span class="fc bfc" id="L101" title="All 2 branches covered.">      for (String namespace : matchNames) {</span>
<span class="fc" id="L102">        var items =</span>
            client
<span class="fc" id="L104">                .genericKubernetesResources(resourceDefinitionContext)</span>
<span class="fc" id="L105">                .inNamespace(namespace)</span>
<span class="fc" id="L106">                .list()</span>
<span class="fc" id="L107">                .getItems();</span>
<span class="fc" id="L108">        Log.debugf(&quot;Found %d %s resources in namespace: %s&quot;, items.size(), pluralKind, namespace);</span>
<span class="fc" id="L109">        list.getItems().addAll(items);</span>
<span class="fc" id="L110">      }</span>

<span class="fc" id="L112">      Log.debugf(&quot;Total %s resources found: %d&quot;, pluralKind, list.getItems().size());</span>
<span class="fc" id="L113">      return list;</span>
<span class="fc" id="L114">    } catch (Exception ex) {</span>
<span class="fc" id="L115">      Log.warnf(&quot;Error retrieving %s/%s resources: %s&quot;, group, pluralKind, ex.getMessage());</span>
      // Returning empty list if retrieval fails. Consider improving error handling.
<span class="fc" id="L117">      return new GenericKubernetesResourceList();</span>
    }
  }

  /**
   * Retrieves application specifications by mapping Kubernetes generic resources.
   *
   * @param client the Kubernetes client instance
   * @param anyNamespace whether to search across all namespaces
   * @param matchNames list of namespaces to filter on if anyNamespace is false
   * @return list of ApplicationSpec instances
   */
  public List&lt;ApplicationSpec&gt; getApplicationSpecs(
      KubernetesClient client, boolean anyNamespace, List&lt;String&gt; matchNames) {
<span class="fc" id="L131">    return getGenericKubernetesResources(client, anyNamespace, matchNames).getItems().stream()</span>
<span class="fc" id="L132">        .map(this::mapToApplicationSpec)</span>
<span class="fc" id="L133">        .toList();</span>
  }

  /**
   * Retrieves application specifications with metadata by mapping Kubernetes generic resources.
   *
   * @param client the Kubernetes client instance
   * @param anyNamespace whether to search across all namespaces
   * @param matchNames list of namespaces to filter on if anyNamespace is false
   * @return list of ApplicationResponse instances with metadata populated
   */
  public List&lt;us.ullberg.startpunkt.objects.ApplicationResponse&gt; getApplicationSpecsWithMetadata(
      KubernetesClient client, boolean anyNamespace, List&lt;String&gt; matchNames) {
<span class="nc" id="L146">    return getApplicationSpecsWithMetadata(client, anyNamespace, matchNames, &quot;local&quot;);</span>
  }

  /**
   * Retrieves application specifications with metadata by mapping Kubernetes generic resources.
   *
   * @param client the Kubernetes client instance
   * @param anyNamespace whether to search across all namespaces
   * @param matchNames list of namespaces to filter on if anyNamespace is false
   * @param clusterName the name of the cluster these resources belong to
   * @return list of ApplicationResponse instances with metadata populated
   */
  public List&lt;us.ullberg.startpunkt.objects.ApplicationResponse&gt; getApplicationSpecsWithMetadata(
      KubernetesClient client, boolean anyNamespace, List&lt;String&gt; matchNames, String clusterName) {
<span class="fc" id="L160">    return getGenericKubernetesResources(client, anyNamespace, matchNames).getItems().stream()</span>
<span class="fc" id="L161">        .map(item -&gt; mapToApplicationSpecWithMetadata(item, clusterName))</span>
<span class="fc" id="L162">        .toList();</span>
  }

  /**
   * Maps a GenericKubernetesResource to an ApplicationResponse instance with metadata.
   *
   * @param item the Kubernetes generic resource
   * @return the ApplicationResponse with metadata populated
   */
  protected us.ullberg.startpunkt.objects.ApplicationResponse mapToApplicationSpecWithMetadata(
      GenericKubernetesResource item) {
<span class="nc" id="L173">    return mapToApplicationSpecWithMetadata(item, &quot;local&quot;);</span>
  }

  /**
   * Maps a GenericKubernetesResource to an ApplicationResponse instance with metadata.
   *
   * @param item the Kubernetes generic resource
   * @param clusterName the name of the cluster this resource belongs to
   * @return the ApplicationResponse with metadata populated
   */
  protected us.ullberg.startpunkt.objects.ApplicationResponse mapToApplicationSpecWithMetadata(
      GenericKubernetesResource item, String clusterName) {
<span class="fc" id="L185">    ApplicationSpec spec = mapToApplicationSpec(item);</span>
<span class="fc" id="L186">    us.ullberg.startpunkt.objects.ApplicationResponse withMetadata =</span>
        new us.ullberg.startpunkt.objects.ApplicationResponse(spec);

    // Populate metadata fields
<span class="fc" id="L190">    withMetadata.setNamespace(getResourceNamespace(item));</span>
<span class="fc" id="L191">    withMetadata.setResourceName(getResourceMetadataName(item));</span>
<span class="fc" id="L192">    withMetadata.setHasOwnerReferences(hasOwnerReferences(item));</span>
<span class="fc" id="L193">    withMetadata.setCluster(clusterName);</span>

<span class="fc" id="L195">    return withMetadata;</span>
  }

  /**
   * Maps a GenericKubernetesResource to an ApplicationSpec instance.
   *
   * @param item the Kubernetes generic resource
   * @return the ApplicationSpec mapped from the resource
   */
  protected ApplicationSpec mapToApplicationSpec(GenericKubernetesResource item) {
<span class="fc" id="L205">    ApplicationSpec spec =</span>
        new ApplicationSpec(
<span class="fc" id="L207">            getAppName(item),</span>
<span class="fc" id="L208">            getAppGroup(item),</span>
<span class="fc" id="L209">            getAppIcon(item),</span>
<span class="fc" id="L210">            getAppIconColor(item),</span>
<span class="fc" id="L211">            getAppUrl(item),</span>
<span class="fc" id="L212">            getAppInfo(item),</span>
<span class="fc" id="L213">            getAppTargetBlank(item),</span>
<span class="fc" id="L214">            getAppLocation(item),</span>
<span class="fc" id="L215">            getAppEnabled(item),</span>
<span class="fc" id="L216">            getAppRootPath(item),</span>
<span class="fc" id="L217">            getAppTags(item));</span>

    // Note: Metadata fields (namespace, resourceName, hasOwnerReferences) are set
    // by ApplicationResource when wrapping in ApplicationResponse
<span class="fc" id="L221">    return spec;</span>
  }

  /**
   * Checks whether a Kubernetes resource has owner references or is managed by ArgoCD.
   *
   * @param item the Kubernetes generic resource
   * @return true if the resource has owner references or is managed by ArgoCD, false otherwise
   */
  protected boolean hasOwnerReferences(GenericKubernetesResource item) {
<span class="pc bpc" id="L231" title="1 of 2 branches missed.">    if (item.getMetadata() == null) {</span>
<span class="nc" id="L232">      return false;</span>
    }

    // Check for owner references
<span class="fc" id="L236">    var ownerRefs = item.getMetadata().getOwnerReferences();</span>
<span class="pc bpc" id="L237" title="2 of 4 branches missed.">    if (ownerRefs != null &amp;&amp; !ownerRefs.isEmpty()) {</span>
<span class="nc" id="L238">      return true;</span>
    }

    // Check for ArgoCD management in managed fields
<span class="fc" id="L242">    var managedFields = item.getMetadata().getManagedFields();</span>
<span class="pc bpc" id="L243" title="2 of 4 branches missed.">    if (managedFields != null &amp;&amp; !managedFields.isEmpty()) {</span>
<span class="nc" id="L244">      return managedFields.stream()</span>
<span class="nc" id="L245">          .anyMatch(</span>
              field -&gt; {
<span class="nc" id="L247">                var manager = field.getManager();</span>
<span class="nc bnc" id="L248" title="All 4 branches missed.">                return manager != null &amp;&amp; manager.contains(&quot;argocd&quot;);</span>
              });
    }

<span class="fc" id="L252">    return false;</span>
  }

  /**
   * Gets the namespace of a Kubernetes resource.
   *
   * @param item the Kubernetes generic resource
   * @return the namespace, or null if metadata is not present
   */
  protected String getResourceNamespace(GenericKubernetesResource item) {
<span class="pc bpc" id="L262" title="1 of 2 branches missed.">    if (item.getMetadata() == null) {</span>
<span class="nc" id="L263">      return null;</span>
    }
<span class="fc" id="L265">    return item.getMetadata().getNamespace();</span>
  }

  /**
   * Gets the metadata name of a Kubernetes resource.
   *
   * @param item the Kubernetes generic resource
   * @return the resource name (metadata.name), or null if metadata is not present
   */
  protected String getResourceMetadataName(GenericKubernetesResource item) {
<span class="pc bpc" id="L275" title="1 of 2 branches missed.">    if (item.getMetadata() == null) {</span>
<span class="nc" id="L276">      return null;</span>
    }
<span class="fc" id="L278">    return item.getMetadata().getName();</span>
  }

  /**
   * Returns the annotations map from the Kubernetes resource metadata.
   *
   * @param item the Kubernetes generic resource
   * @return map of annotations or null if none present
   */
  protected Map&lt;String, String&gt; getAnnotations(GenericKubernetesResource item) {
<span class="pc bpc" id="L288" title="1 of 2 branches missed.">    if (item.getMetadata() == null) {</span>
<span class="nc" id="L289">      return null;</span>
    }
<span class="fc" id="L291">    return item.getMetadata().getAnnotations();</span>
  }

  /**
   * Returns the spec map from the Kubernetes resource.
   *
   * @param item the Kubernetes generic resource
   * @return spec map or null if not present
   */
  @SuppressWarnings(&quot;unchecked&quot;)
  protected Map&lt;String, Object&gt; getSpec(GenericKubernetesResource item) {
<span class="fc" id="L302">    Map&lt;String, Object&gt; props = getProps(item);</span>
<span class="pc bpc" id="L303" title="1 of 2 branches missed.">    if (props == null) {</span>
<span class="nc" id="L304">      return Map.of();</span>
    }
<span class="fc" id="L306">    return (Map&lt;String, Object&gt;) props.get(&quot;spec&quot;);</span>
  }

  /**
   * Returns additional properties map from the Kubernetes resource.
   *
   * @param item the Kubernetes generic resource
   * @return map of additional properties or null if none present
   */
  protected Map&lt;String, Object&gt; getProps(GenericKubernetesResource item) {
<span class="fc" id="L316">    return item.getAdditionalProperties();</span>
  }

  /**
   * Returns the application name. Defaults to resource metadata name in lowercase.
   *
   * @param item the Kubernetes generic resource
   * @return application name
   */
  protected String getAppName(GenericKubernetesResource item) {
<span class="fc" id="L326">    return item.getMetadata().getName().toLowerCase();</span>
  }

  /**
   * Returns the application group. Defaults to resource namespace in lowercase.
   *
   * @param item the Kubernetes generic resource
   * @return application group
   */
  protected String getAppGroup(GenericKubernetesResource item) {
<span class="fc" id="L336">    return item.getMetadata().getNamespace().toLowerCase();</span>
  }

  /**
   * Returns the application URL from the resource.
   *
   * @param item the Kubernetes generic resource
   * @return URL string or null if not provided
   */
  protected String getAppUrl(GenericKubernetesResource item) {
<span class="fc" id="L346">    return null;</span>
  }

  /**
   * Returns the application icon from the resource.
   *
   * @param item the Kubernetes generic resource
   * @return icon string or null if not provided
   */
  protected String getAppIcon(GenericKubernetesResource item) {
<span class="fc" id="L356">    return null;</span>
  }

  /**
   * Returns the application icon color from the resource.
   *
   * @param item the Kubernetes generic resource
   * @return icon color string or null if not provided
   */
  protected String getAppIconColor(GenericKubernetesResource item) {
<span class="fc" id="L366">    return null;</span>
  }

  /**
   * Returns application info from the resource.
   *
   * @param item the Kubernetes generic resource
   * @return info string or null if not provided
   */
  protected String getAppInfo(GenericKubernetesResource item) {
<span class="fc" id="L376">    return null;</span>
  }

  /**
   * Returns whether the application URL should open in a new tab.
   *
   * @param item the Kubernetes generic resource
   * @return Boolean flag or false if not specified
   */
  @Nullable
  protected Boolean getAppTargetBlank(GenericKubernetesResource item) {
<span class="fc" id="L387">    return false;</span>
  }

  /**
   * Returns the sorting location for the application.
   *
   * @param item the Kubernetes generic resource
   * @return integer location, default is 1000
   */
  protected int getAppLocation(GenericKubernetesResource item) {
<span class="fc" id="L397">    return 1000;</span>
  }

  /**
   * Returns whether the application is enabled.
   *
   * @param item the Kubernetes generic resource
   * @return Boolean flag or false if not specified
   */
  @Nullable
  protected Boolean getAppEnabled(GenericKubernetesResource item) {
<span class="nc" id="L408">    return false;</span>
  }

  /**
   * Returns the protocol of the application URL.
   *
   * @param item the Kubernetes generic resource
   * @return protocol string or null if not specified
   */
  protected String getAppProtocol(GenericKubernetesResource item) {
<span class="fc" id="L418">    return null;</span>
  }

  /**
   * Returns the port number for the application URL.
   *
   * @param item the Kubernetes generic resource
   * @return port number or null if not specified
   */
  protected Integer getAppPort(GenericKubernetesResource item) {
<span class="fc" id="L428">    return null;</span>
  }

  /**
   * Returns the tags of the application. By default, reads from the &quot;startpunkt.ullberg.us/tags&quot;
   * annotation.
   *
   * @param item the Kubernetes generic resource
   * @return comma-separated tags string or null if not set
   */
  protected String getAppTags(GenericKubernetesResource item) {
<span class="fc" id="L439">    var annotations = getAnnotations(item);</span>
<span class="pc bpc" id="L440" title="2 of 4 branches missed.">    if (annotations != null &amp;&amp; annotations.containsKey(&quot;startpunkt.ullberg.us/tags&quot;)) {</span>
<span class="nc" id="L441">      return annotations.get(&quot;startpunkt.ullberg.us/tags&quot;);</span>
    }
<span class="fc" id="L443">    return null;</span>
  }

  /**
   * Retrieves a string property from the spec or returns a fallback value.
   *
   * @param item the Kubernetes generic resource
   * @param key the key to lookup in the spec
   * @param fallback fallback value if key is absent
   * @return value from spec or fallback
   */
  protected String getOptionalSpecString(
      GenericKubernetesResource item, String key, String fallback) {
<span class="fc" id="L456">    var spec = getSpec(item);</span>
<span class="pc bpc" id="L457" title="1 of 4 branches missed.">    return spec != null &amp;&amp; spec.containsKey(key) ? spec.get(key).toString() : fallback;</span>
  }

  /**
   * Retrieves a boolean property from the spec or returns a fallback value.
   *
   * @param item the Kubernetes generic resource
   * @param key the key to lookup in the spec
   * @param fallback fallback boolean value if key is absent
   * @return boolean value from spec or fallback
   */
  protected Boolean getOptionalSpecBoolean(
      GenericKubernetesResource item, String key, Boolean fallback) {
<span class="fc" id="L470">    var spec = getSpec(item);</span>
<span class="pc bpc" id="L471" title="1 of 4 branches missed.">    return spec != null &amp;&amp; spec.containsKey(key)</span>
<span class="fc" id="L472">        ? Boolean.parseBoolean(spec.get(key).toString())</span>
<span class="fc" id="L473">        : fallback;</span>
  }

  /**
   * Retrieves an integer property from the spec or returns a fallback value.
   *
   * @param item the Kubernetes generic resource
   * @param key the key to lookup in the spec
   * @param fallback fallback integer value if key is absent
   * @return integer value from spec or fallback
   */
  protected Integer getOptionalSpecInteger(
      GenericKubernetesResource item, String key, Integer fallback) {
<span class="fc" id="L486">    var spec = getSpec(item);</span>
<span class="pc bpc" id="L487" title="1 of 4 branches missed.">    return spec != null &amp;&amp; spec.containsKey(key)</span>
<span class="fc" id="L488">        ? Integer.parseInt(spec.get(key).toString())</span>
<span class="fc" id="L489">        : fallback;</span>
  }

  /**
   * Builds a URL with optional port number. Omits standard ports (80 for HTTP, 443 for HTTPS).
   *
   * @param protocol the protocol (e.g., &quot;http&quot;, &quot;https&quot;)
   * @param host the hostname
   * @param port the port number, or null to omit port
   * @param path the path component (including leading slash), or null/empty for no path
   * @return constructed URL string
   */
  protected String buildUrlWithPort(String protocol, String host, Integer port, String path) {
<span class="fc" id="L502">    StringBuilder url = new StringBuilder();</span>

    // Normalize protocol: accept values like &quot;http&quot;, &quot;https&quot;, &quot;http://&quot; or &quot;https://&quot;
<span class="pc bpc" id="L505" title="1 of 2 branches missed.">    String proto = (protocol == null) ? &quot;http&quot; : protocol;</span>
<span class="pc bpc" id="L506" title="1 of 2 branches missed.">    if (proto.endsWith(&quot;://&quot;)) {</span>
<span class="nc" id="L507">      proto = proto.substring(0, proto.length() - 3);</span>
    }

    // Add protocol and host
<span class="fc" id="L511">    url.append(proto).append(&quot;://&quot;).append(host);</span>

    // Add port if specified and not a standard port (80 for http, 443 for https)
<span class="fc bfc" id="L514" title="All 2 branches covered.">    if (port != null) {</span>
<span class="fc" id="L515">      boolean isStandardPort =</span>
<span class="fc bfc" id="L516" title="All 4 branches covered.">          (proto.equalsIgnoreCase(&quot;http&quot;) &amp;&amp; port == 80)</span>
<span class="fc bfc" id="L517" title="All 4 branches covered.">              || (proto.equalsIgnoreCase(&quot;https&quot;) &amp;&amp; port == 443);</span>
<span class="fc bfc" id="L518" title="All 2 branches covered.">      if (!isStandardPort) {</span>
<span class="fc" id="L519">        url.append(&quot;:&quot;).append(port);</span>
      }
    }

    // Add path if present
<span class="fc bfc" id="L524" title="All 4 branches covered.">    if (path != null &amp;&amp; !path.isEmpty()) {</span>
<span class="pc bpc" id="L525" title="1 of 2 branches missed.">      if (!path.startsWith(&quot;/&quot;)) {</span>
<span class="nc" id="L526">        url.append(&quot;/&quot;);</span>
      }
<span class="fc" id="L528">      url.append(path);</span>
    }

<span class="fc" id="L531">    return url.toString();</span>
  }

  /**
   * Retrieves the application root path from resource annotations.
   *
   * @param item Kubernetes resource
   * @return root path string or null if not found
   */
  protected String getAppRootPath(GenericKubernetesResource item) {
<span class="fc" id="L541">    var annotations = getAnnotations(item);</span>
<span class="pc bpc" id="L542" title="2 of 4 branches missed.">    if (annotations != null &amp;&amp; annotations.containsKey(&quot;startpunkt.ullberg.us/rootPath&quot;)) {</span>
<span class="nc" id="L543">      return annotations.get(&quot;startpunkt.ullberg.us/rootPath&quot;);</span>
    }
<span class="fc" id="L545">    return null;</span>
  }

  /**
   * Appends the root path to the URL if a rootPath annotation is present.
   *
   * @param url base URL
   * @param item Kubernetes resource to get rootPath from
   * @return URL with rootPath appended or original URL if no rootPath
   */
  protected String appendRootPath(String url, GenericKubernetesResource item) {
<span class="fc bfc" id="L556" title="All 2 branches covered.">    if (url == null) {</span>
<span class="fc" id="L557">      return null;</span>
    }

<span class="fc" id="L560">    String rootPath = getAppRootPath(item);</span>
<span class="pc bpc" id="L561" title="3 of 4 branches missed.">    if (rootPath != null &amp;&amp; !rootPath.isEmpty()) {</span>
<span class="nc" id="L562">      return appendRootPath(url, rootPath);</span>
    }
<span class="fc" id="L564">    return url;</span>
  }

  /**
   * Appends the root path to the URL.
   *
   * @param url base URL
   * @param rootPath root path to append
   * @return URL with rootPath appended
   */
  protected String appendRootPath(String url, String rootPath) {
<span class="nc bnc" id="L575" title="All 2 branches missed.">    if (url == null) {</span>
<span class="nc" id="L576">      return null;</span>
    }

<span class="nc bnc" id="L579" title="All 4 branches missed.">    if (rootPath != null &amp;&amp; !rootPath.isEmpty()) {</span>
      // Ensure the URL doesn't end with a slash and rootPath starts with a slash
<span class="nc bnc" id="L581" title="All 2 branches missed.">      String normalizedUrl = url.endsWith(&quot;/&quot;) ? url.substring(0, url.length() - 1) : url;</span>
<span class="nc bnc" id="L582" title="All 2 branches missed.">      String normalizedRootPath = rootPath.startsWith(&quot;/&quot;) ? rootPath : &quot;/&quot; + rootPath;</span>
<span class="nc" id="L583">      return normalizedUrl + normalizedRootPath;</span>
    }
<span class="nc" id="L585">    return url;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>